title: "Coolify Only - Self-hosted App Platform"
description: "Deploy only Coolify server on Oracle Cloud Always Free tier (2 OCPUs, 12GB RAM, 100GB storage)"
schemaVersion: 1.1.0
version: "20240201"
locale: "en"

variableGroups:
  - title: "Authentication"
    variables:
      - tenancy_ocid
      - region
      - parent_compartment_ocid
      - compartment_name
      - user_ocid
      - fingerprint
      - private_key_path
  - title: "Compute"
    variables:
      - ssh_authorized_keys
      - instance_shape
      - availability_domain
      - deployment_label
      - custom_image_ocid
  - title: "Coolify server sizing"
    variables:
      - coolify_ocpus
      - coolify_memory_in_gbs
      - coolify_block_volume_size_in_gbs
      - coolify_custom_tcp_ports
      - assign_public_ip
  - title: "üåê Cloudflare Tunnel (Optional)"
    description: "Configure secure access to Coolify through Cloudflare tunnel with automatic SSL certificates"
    variables:
      - enable_cloudflare_tunnel
      - cloudflare_api_token
      - cloudflare_account_id
      - cloudflare_zone_id
      - tunnel_hostname
      - ssh_hostname

variables:
  tenancy_ocid:
    type: string
    title: "Tenancy OCID"
    description: "OCID of the tenancy where resources will be created."
    required: true
  region:
    type: string
    title: "Region"
    description: "Target OCI region (for example, us-phoenix-1)."
    required: true
  parent_compartment_ocid:
    type: string
    title: "Parent Compartment OCID"
    description: "Parent compartment where the new compartment will be created. Use tenancy OCID for root compartment."
    required: true
  compartment_name:
    type: string
    title: "Compartment Name"
    description: "Name for the new compartment that will contain all VibeStack resources."
    default: "vibestack"
    required: true
    pattern: "^[a-zA-Z][a-zA-Z0-9_-]{0,99}$"
  user_ocid:
    type: string
    title: "User OCID"
    description: "Optional user OCID used for API key authentication."
  fingerprint:
    type: string
    title: "Fingerprint"
    description: "Optional fingerprint for the API signing key."
  private_key_path:
    type: string
    title: "Private key path"
    description: "Path to the API signing private key when running Terraform locally."
  ssh_authorized_keys:
    type: string
    title: "SSH public keys"
    description: "SSH public keys (one per line) that should be provisioned on the server."
    required: true
    multiline: true
  instance_shape:
    type: string
    title: "Compute shape"
    description: "Compute shape to use for the server."
    default: "VM.Standard.A1.Flex"
  availability_domain:
    type: string
    title: "Availability domain"
    description: "Optional availability domain name. Leave blank to use the first available AD."
  deployment_label:
    type: string
    title: "Deployment label"
    description: "Optional suffix appended to resource display names to keep them unique."
  custom_image_ocid:
    type: string
    title: "Custom image OCID"
    description: "Override the automatically selected platform image with a custom compute image."
  coolify_ocpus:
    type: integer
    title: "Coolify OCPUs"
    description: "Number of OCPUs allocated to the Coolify server."
    minimum: 1
    default: 2
  coolify_memory_in_gbs:
    type: integer
    title: "Coolify memory (GB)"
    description: "Memory assigned to the Coolify server in GB."
    minimum: 1
    default: 12
  coolify_block_volume_size_in_gbs:
    type: integer
    title: "Coolify data volume size (GB)"
    description: "Size of the block volume attached to the Coolify server."
    minimum: 50
    default: 100
  coolify_custom_tcp_ports:
    type: array
    title: "Additional Coolify TCP ports"
    description: "Extra TCP ports that should be opened to the internet for the Coolify server."
    items:
      type: integer
  coolify_root_username:
    type: string
    title: "Coolify Admin Username"
    description: "Username for the Coolify admin account"
    default: "admin"
    pattern: "^[a-zA-Z0-9_-]{3,30}$"
  coolify_root_user_email:
    type: string
    title: "Coolify Admin Email"
    description: "Email address for the Coolify admin account (required)"
    required: true
    pattern: "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
  assign_public_ip:
    type: boolean
    title: "Assign public IP addresses"
    description: "Assign public IPv4 address to the compute instance."
    default: true
  image_operating_system:
    type: string
    title: "Operating system"
    description: "Operating system to use for the server."
    default: "Canonical Ubuntu"
    visible: false
  image_operating_system_version:
    type: string
    title: "Operating system version"
    description: "Version of the operating system (22.04 for Ubuntu, 8 or 9 for Oracle Linux)."
    default: "22.04"
    visible: false
  deploy_kasm:
    type: boolean
    title: "Deploy KASM server"
    description: "Deploy KASM Workspaces server."
    default: false
    visible: false
  deploy_coolify:
    type: boolean
    title: "Deploy Coolify server"
    description: "Deploy Coolify server."
    default: true
    visible: false
  enable_cloudflare_tunnel:
    type: boolean
    title: "Enable Cloudflare Tunnel"
    description: "Set up secure tunnel through Cloudflare for your Coolify instance with automatic SSL certificates"
    default: false
  cloudflare_api_token:
    type: password
    title: "Cloudflare API Token"
    description: "Create at: Cloudflare Dashboard ‚Üí My Profile ‚Üí API Tokens. Required permissions: Zone:DNS:Edit, Account:Cloudflare Tunnel:Edit"
    visible:
      eq:
        - enable_cloudflare_tunnel
        - true
  cloudflare_account_id:
    type: string
    title: "Cloudflare Account ID"
    description: "Found in your Cloudflare Dashboard ‚Üí Right sidebar"
    visible:
      eq:
        - enable_cloudflare_tunnel
        - true
    pattern: "^[a-f0-9]{32}$"
  cloudflare_zone_id:
    type: string
    title: "Cloudflare Zone ID"
    description: "Found in your domain's Cloudflare Dashboard ‚Üí Right sidebar"
    visible:
      eq:
        - enable_cloudflare_tunnel
        - true
    pattern: "^[a-f0-9]{32}$"
  tunnel_hostname:
    type: string
    title: "Coolify Hostname"
    description: "Domain for accessing Coolify (e.g., coolify.yourdomain.com)"
    visible:
      eq:
        - enable_cloudflare_tunnel
        - true
    pattern: "^[a-z0-9-]+\\.[a-z0-9.-]+\\.[a-z]{2,}$"
  ssh_hostname:
    type: string
    title: "SSH Hostname (Optional)"
    description: "Domain for SSH access (e.g., ssh.yourdomain.com). Leave empty to auto-generate"
    visible:
      eq:
        - enable_cloudflare_tunnel
        - true
  enable_custom_ssl:
    type: boolean
    title: "Enable Cloudflare Origin Certificate"
    description: "Deploy SSL certificate for HTTPS access to Coolify"
    default: false
  origin_certificate:
    type: text
    title: "Origin Certificate"
    description: "Paste your Cloudflare Origin Certificate (PEM format)"
    visible:
      eq:
        - enable_custom_ssl
        - true
  private_key:
    type: text
    title: "Private Key"
    description: "Paste your Cloudflare Origin Certificate private key (PEM format)"
    visible:
      eq:
        - enable_custom_ssl
        - true

outputs:
  compartment:
    title: "Created compartment"
  network:
    title: "Network details"
  coolify_server:
    title: "Coolify server"
  security_list_ingress_ports:
    title: "Open TCP ports"
